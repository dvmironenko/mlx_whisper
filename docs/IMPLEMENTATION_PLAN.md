# План реализации: Объяснение функциональности приложения

## Контекст
Пользователь хочет понять, что делает приложение. Я провел анализ кодовой базы MLX-Whisper для веб-транскрибации аудио, чтобы предоставить полное объяснение его функциональности.

## Обзор приложения

Приложение представляет собой веб-сервис для транскрибации и перевода аудио с использованием оптимизированной модели Whisper от Apple (MLX-Whisper). Оно предоставляет как веб-интерфейс, так и REST API для преобразования речи в текст с поддержкой нескольких языков и гибких параметров обработки.

## Основные компоненты приложения

### 1. Главное FastAPI-приложение (`src/main.py`)
- Основная точка входа, построенная на FastAPI
- Обработка HTTP-запросов и ответов для операций транскрибации
- Интеграция с моделью MLX-Whisper для транскрибации
- Обработка цепочки файлов с использованием FFmpeg для конвертации в WAV (16 кГц, моно)
- Оптимизация памяти с использованием потоков

### 2. Веб-интерфейс
- HTML шаблон (`src/templates/index.html`) с встроенным JavaScript
- CSS стили (`src/static/style.css`) для отображения интерфейса
- Предоставляет удобный веб-интерфейс для загрузки аудиофайлов и обработки

### 3. Архитектура обработки аудио
- Поддержка различных форматов (WAV, MP3, M4A, FLAC, AAC, OGG, WMA, WEBM, MP4)
- Использование FFmpeg для автоматической конвертации в WAV формат
- Поддержка нескольких размеров модели Whisper (tiny, base, small, medium, turbo, large)
- Оптимизация памяти через обработку файлов по частям

## Технические особенности

### Управление памятью
- Обработка файлов частями по 8 КБ для предотвращения переполнения памяти
- Использование ThreadPoolExecutor с ограниченным количеством рабочих потоков (2) для тяжелых задач транскрибации
- Автоматическая очистка временных файлов после обработки

### Обработка ошибок и надежность
- Полная обработка ошибок с соответствующими HTTP-кодами состояния
- Безопасное удаление временных файлов при ошибках обработки
- JSON сериализация с особым подходом к numpy типам и недопустимым значениям float

### REST API Endpoints
- `/` - веб-интерфейс, предоставляющий HTML шаблон
- `/health` - проверка состояния сервиса
- `/models` - список поддерживаемых моделей
- `/job/{job_id}` - проверка статуса задачи транскрибации
- `/transcribe` - основная точка входа для транскрибации аудиофайлов

### Особенности веб-интерфейса
- Интуитивно понятная форма с выбором языка, типом задачи и размером модели
- Параметры управления: включение временных меток, контекстная обработка и пороговые значения
- Четкое отображение результатов транскрибации с возможностью скачивания
- Различные варианты скачивания: текст, сегменты (с временными метками) или комбинированные файлы

## Структура кода

Приложение следует модульной структуре:
1. **Основное приложение** (`src/main.py`): Основная логика FastAPI, функции транскрибации и обработка ошибок
2. **Веб-интерфейс** (`src/templates/index.html`): Шаблон фронтенда с встроенным JavaScript для клиентских взаимодействий
3. **Стилизация** (`src/static/style.css`): CSS файлы для адаптивного дизайна и визуального представления

## Заключение
Приложение предоставляет надежное, масштабируемое решение для транскрибации аудио с интуитивно понятным веб-интерфейсом и правильной обработкой ошибок. Использование MLX-Whisper обеспечивает оптимизированные характеристики производительности от Apple, при этом сохраняя доступность через веб-интерфейс.

## Проверка
Для проверки корректности реализации необходимо:
1. Запустить приложение и протестировать веб-интерфейс
2. Использовать API endpoints для транскрибации файлов
3. Проверить обработку различных форматов аудио
4. Убедиться в корректной работе с временными файлами и памятью